$((function(){$.fn.googleMap=function(params){switch((params=$.extend({zoom:10,coords:[48.895651,2.290569],type:"ROADMAP",debug:!1,langage:"english",overviewMapControl:!1,streetViewControl:!1,scrollwheel:!1,mapTypeControl:!1},params)).type){case"ROADMAP":case"SATELLITE":case"HYBRID":case"TERRAIN":params.type=google.maps.MapTypeId[params.type];break;default:params.type=google.maps.MapTypeId.ROADMAP}return this.each((function(){var map=new google.maps.Map(this,{zoom:params.zoom,center:new google.maps.LatLng(params.coords[0],params.coords[1]),mapTypeId:params.type,scrollwheel:params.scrollwheel,streetViewControl:params.streetViewControl,overviewMapControl:params.overviewMapControl,mapTypeControl:params.mapTypeControl});$(this).data("googleMap",map),$(this).data("googleLang",params.langage),$(this).data("googleDebug",params.debug),$(this).data("googleMarker",new Array),$(this).data("googleBound",new google.maps.LatLngBounds)})),this},$.fn.addMarker=function(params){return params=$.extend({coords:!1,address:!1,url:!1,id:!1,icon:!1,draggable:!1,title:"",text:"",success:function(){}},params),this.each((function(){if($this=$(this),!$this.data("googleMap"))return $this.data("googleDebug")&&console.error("jQuery googleMap : Unable to add a marker where there is no map !"),!1;if(!params.coords&&!params.address)return $this.data("googleDebug")&&console.error("jQuery googleMap : Unable to add a marker if you don't tell us where !"),!1;if(params.address&&"string"==typeof params.address)var geocodeAsync=($that=$this,void(new google.maps.Geocoder).geocode({address:params.address,bounds:$that.data("googleBound"),language:$that.data("googleLang")},(function(results,status){if(status==google.maps.GeocoderStatus.OK){if($that.data("googleBound").extend(results[0].geometry.location),params.icon)var marker=new google.maps.Marker({map:$this.data("googleMap"),position:results[0].geometry.location,title:params.title,icon:params.icon,draggable:params.draggable});else var marker=new google.maps.Marker({map:$that.data("googleMap"),position:results[0].geometry.location,title:params.title,draggable:params.draggable});if(params.draggable&&google.maps.event.addListener(marker,"dragend",(function(){var location=marker.getPosition(),coords={};coords.lat=location.lat(),coords.lon=location.lng(),params.success(coords,$this)})),""==params.title||""==params.text||params.url)params.url&&google.maps.event.addListener(marker,"click",(function(){document.location=params.url}));else{var infowindow=new google.maps.InfoWindow({content:"<h1>"+params.title+"</h1>"+params.text}),map=$that.data("googleMap");google.maps.event.addListener(marker,"click",(function(){infowindow.open(map,marker)}))}params.id?$that.data("googleMarker")[params.id]=marker:$that.data("googleMarker").push(marker),1==$that.data("googleMarker").length?($that.data("googleMap").setCenter(results[0].geometry.location),$that.data("googleMap").setZoom($that.data("googleMap").getZoom())):$that.data("googleMap").fitBounds($that.data("googleBound"));var coords={};coords.lat=results[0].geometry.location.lat(),coords.lon=results[0].geometry.location.lng(),params.success(coords,$this)}else $this.data("googleDebug")&&console.error("jQuery googleMap : Unable to find the place asked for the marker ("+status+")")})));else{if($this.data("googleBound").extend(new google.maps.LatLng(params.coords[0],params.coords[1])),params.icon)var marker=new google.maps.Marker({map:$this.data("googleMap"),position:new google.maps.LatLng(params.coords[0],params.coords[1]),title:params.title,icon:params.icon,draggable:params.draggable});else var marker=new google.maps.Marker({map:$this.data("googleMap"),position:new google.maps.LatLng(params.coords[0],params.coords[1]),title:params.title,draggable:params.draggable});if(""==params.title||""==params.text||params.url)params.url&&google.maps.event.addListener(marker,"click",(function(){document.location=params.url}));else{var infowindow=new google.maps.InfoWindow({content:"<h1>"+params.title+"</h1>"+params.text}),map=$this.data("googleMap");google.maps.event.addListener(marker,"click",(function(){infowindow.open(map,marker)}))}params.draggable&&google.maps.event.addListener(marker,"dragend",(function(){var location=marker.getPosition(),coords={};coords.lat=location.lat(),coords.lon=location.lng(),params.success(coords,$this)})),params.id?$this.data("googleMarker")[params.id]=marker:$this.data("googleMarker").push(marker),1==$this.data("googleMarker").length?($this.data("googleMap").setCenter(new google.maps.LatLng(params.coords[0],params.coords[1])),$this.data("googleMap").setZoom($this.data("googleMap").getZoom())):$this.data("googleMap").fitBounds($this.data("googleBound")),params.success({lat:params.coords[0],lon:params.coords[1]},$this)}var $that,geocoder})),this},$.fn.removeMarker=function(id){this.each((function(){var $this=$(this);if(!$this.data("googleMap"))return $this.data("googleDebug")&&console.log("jQuery googleMap : Unable to delete a marker where there is no map !"),!1;var $markers=$this.data("googleMarker");return void 0!==$markers[id]?($markers[id].setMap(null),$this.data("googleDebug")&&console.log("jQuery googleMap : marker deleted"),!0):($this.data("googleDebug")&&console.error("jQuery googleMap : Unable to delete a marker if it not exists !"),!1)}))},$.fn.addWay=function(params){params=$.extend({start:!1,end:!1,step:[],route:!1,langage:"english"},params);var direction=new google.maps.DirectionsService({region:"fr"}),way=new google.maps.DirectionsRenderer({draggable:!0,map:$(this).data("googleMap"),panel:document.getElementById(params.route),provideTripAlternatives:!0});document.getElementById.innerHTML="";var waypoints=[],$that,geocoder;for(var i in params.step){var step;step="object"==typeof params.step[i]?new google.maps.LatLng(params.step[i][0],params.step[i][1]):params.step[i],waypoints.push({location:step,stopover:!0})}if("object"!=typeof params.end)var geocodeAsync=($that=$(this),void(new google.maps.Geocoder).geocode({address:params.end,bounds:$that.data("googleBound"),language:params.langage},(function(results,status){if(status==google.maps.GeocoderStatus.OK){var request={origin:params.start,destination:results[0].geometry.location,travelMode:google.maps.DirectionsTravelMode.DRIVING,region:"fr",waypoints:waypoints};direction.route(request,(function(response,status){status==google.maps.DirectionsStatus.OK?way.setDirections(response):$that.data("googleDebug")&&console.error("jQuery googleMap : Unable to find the place asked for the route ("+response+")")}))}else $that.data("googleDebug")&&console.error("jQuery googleMap : Address not found")})));else{var request={origin:params.start,destination:new google.maps.LatLng(params.end[0],params.end[1]),travelMode:google.maps.DirectionsTravelMode.DRIVING,region:"fr",waypoints:waypoints};direction.route(request,(function(response,status){status==google.maps.DirectionsStatus.OK?way.setDirections(response):$(this).data("googleDebug")&&console.error("jQuery googleMap : Address not found")}))}return this}}));